<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <title>Админ-панель</title>
    <style>
        body { font-family: Arial, sans-serif; background: #add8e6; margin: 0; padding: 20px; }
        .form-group { margin-bottom: 15px; max-width: 300px; }
        label { display: block; margin-bottom: 5px; }
        input, select, button { width: 100%; padding: 8px; box-sizing: border-box; }
        button { background: #1e90ff; color: white; border: none; cursor: pointer; }
        button:hover { background: #104e8b; }
        #result { margin-top: 15px; }
        .category-section { margin-bottom: 20px; }
    </style>
</head>
<body>
    <h2>Админ-панель Оптовый Улов</h2>

    <div class="category-section">
        <h3>Создать категорию</h3>
        <form id="category-form">
            <div class="form-group">
                <label for="category-name">Название категории:</label>
                <input type="text" id="category-name" name="category-name" required>
            </div>
            <div class="form-group">
                <label for="parent-id">Родительская категория (опционально):</label>
                <select id="parent-id" name="parent-id">
                    <option value="">Нет</option>
                </select>
            </div>
            <button type="submit">Создать категорию</button>
        </form>
        <div id="category-result"></div>
    </div>

    <form id="upload-form">
        <div class="form-group">
            <label for="name">Название:</label>
            <input type="text" id="name" name="name" required>
        </div>
        <div class="form-group">
            <label for="description">Описание:</label>
            <input type="text" id="description" name="description" required>
        </div>
        <div class="form-group">
            <label for="price">Цена:</label>
            <input type="number" id="price" name="price" step="0.01" required>
        </div>
        <div class="form-group">
            <label for="category-id">Категория:</label>
            <select id="category-id" name="category-id" required></select>
        </div>
        <div class="form-group">
            <label for="images">Изображения (множественный выбор):</label>
            <input type="file" id="images" name="images" multiple>
        </div>
        <button type="submit">Добавить товар</button>
    </form>
    <div id="result"></div>

    <script>
        async function loadCategories() {
            const categorySelect = document.getElementById('category-id');
            const parentSelect = document.getElementById('parent-id');
            const response = await fetch('/api/categories');
            const categories = await response.json();
            categorySelect.innerHTML = '<option value="">Выберите категорию</option>' + categories.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
            parentSelect.innerHTML = '<option value="">Нет</option>' + categories.filter(c => !c.parent_id).map(c => `<option value="${c.id}">${c.name}</option>`).join('');
        }

        document.getElementById('category-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = new URLSearchParams(new FormData(e.target));
            try {
                const response = await fetch('/api/categories', { method: 'POST', body: data });
                if (!response.ok) throw new Error(`Ошибка: ${response.status}`);
                const result = await response.json();
                document.getElementById('category-result').innerHTML = result.message;
                e.target.reset();
                loadCategories();
            } catch (error) {
                document.getElementById('category-result').innerHTML = `Ошибка: ${error.message}`;
            }
        });

        document.getElementById('upload-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const images = document.getElementById('images').files;
            for (let i = 0; i < images.length; i++) {
                formData.append('images', images[i]);
            }
            try {
                const response = await fetch('/api/admin/upload', { method: 'POST', body: formData });
                if (!response.ok) throw new Error(`Ошибка: ${response.status}`);
                const result = await response.json();
                document.getElementById('result').innerHTML = `Статус: ${result.status} | Сообщение: ${result.message}`;
                e.target.reset();
            } catch (error) {
                document.getElementById('result').innerHTML = `Ошибка: ${error.message}`;
            }
        });

        window.onload = loadCategories;
    </script>
</body>
</html>
