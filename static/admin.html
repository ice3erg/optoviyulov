<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#1e40af" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .header::before {
            content: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%231e40af"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15h-2v-2h2v2zm0-4h-2V7h2v6zm4 4h-2v-2h2v2zm0-4h-2V7h2v6z"/><path d="M17 10l-5-5-5 5h10z"/></svg>');
            position: absolute;
            left: 1rem;
            top: 1rem;
            width: 1.5rem;
            height: 1.5rem;
        }
        .language-switch {
            position: absolute;
            top: 1rem;
            right: 1rem;
        }
    </style>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body class="bg-gray-100 font-sans text-gray-800">
    <header class="header bg-blue-700 text-white text-2xl font-bold p-4 relative shadow-md">
        –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
    </header>
    <div class="mx-4 mt-4 p-4 bg-white rounded-lg shadow-md">
        <h2 class="text-xl font-semibold text-blue-800 mb-4">–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h2>
        <form id="category-form" class="mb-4">
            <input type="text" id="category-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏" class="w-full p-2 border border-blue-300 rounded-lg mb-2">
            <input type="number" id="category-parent" placeholder="ID —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)" class="w-full p-2 border border-blue-300 rounded-lg mb-2">
            <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition duration-200">–°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
        </form>
        <h2 class="text-xl font-semibold text-blue-800 mb-4">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h2>
        <form id="product-form" class="mb-4" enctype="multipart/form-data">
            <input type="text" id="product-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞" class="w-full p-2 border border-blue-300 rounded-lg mb-2">
            <textarea id="product-description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" class="w-full p-2 border border-blue-300 rounded-lg mb-2"></textarea>
            <input type="number" id="product-price" step="0.01" placeholder="–¶–µ–Ω–∞" class="w-full p-2 border border-blue-300 rounded-lg mb-2">
            <select id="product-category" class="w-full p-2 border border-blue-300 rounded-lg mb-2">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
            </select>
            <input type="file" id="product-images" name="images" multiple class="w-full p-2 border border-blue-300 rounded-lg mb-2">
            <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition duration-200">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
        </form>
    </div>
    <footer class="footer fixed bottom-0 w-full bg-blue-700 p-2 flex justify-around shadow-lg">
        <a href="/" class="text-white text-2xl hover:text-blue-200 transition duration-200">üè†</a>
    </footer>
    <div class="store-info text-center text-blue-800 mt-4">
        <p class="text-sm">–û–ø—Ç–æ–≤—ã–π –£–ª–æ–≤ - –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</p>
        <p class="text-xs text-gray-600">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 14 –∏—é–Ω—è 2025, 08:29 AM PDT</p>
    </div>

    <script>
        async function loadCategories() {
            const response = await fetch('/api/categories');
            const categories = await response.json();
            const select = document.getElementById('product-category');
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>' + categories.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
        }

        document.getElementById('category-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('category-name').value;
            const parentId = document.getElementById('category-parent').value || null;
            const response = await fetch('/api/admin/create_category', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: new URLSearchParams({ name, parent_id: parentId })
            });
            if (response.ok) {
                alert('–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å–æ–∑–¥–∞–Ω–∞!');
                document.getElementById('category-name').value = '';
                document.getElementById('category-parent').value = '';
                loadCategories();
            } else {
                alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏');
            }
        });

        document.getElementById('product-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData();
            formData.append('name', document.getElementById('product-name').value);
            formData.append('description', document.getElementById('product-description').value);
            formData.append('price', document.getElementById('product-price').value);
            formData.append('category_id', document.getElementById('product-category').value);
            const images = document.getElementById('product-images').files;
            for (let i = 0; i < images.length; i++) {
                formData.append('images', images[i]);
            }

            const response = await fetch('/api/admin/upload', {
                method: 'POST',
                body: formData
            });
            if (response.ok) {
                alert('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω!');
                document.getElementById('product-name').value = '';
                document.getElementById('product-description').value = '';
                document.getElementById('product-price').value = '';
                document.getElementById('product-category').value = '';
                document.getElementById('product-images').value = '';
            } else {
                alert('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞');
            }
        });

        window.onload = () => {
            loadCategories();
            if (window.Telegram?.WebApp) window.Telegram.WebApp.ready();
        };
    </script>
</body>
</html>
